{% extends "base.html" %}

{% block title %}Detail Santri - {{ student.name }} - PonPay{% endblock %}

{% block page_title %}
<div class="d-flex justify-content-between align-items-center">
    <div>
        <h1 class="page-title"><i class="fas fa-user-graduate"></i> {{ student.name }}</h1>
        <p class="text-muted">{{ student.kelas }} â€¢ NISN: {{ student.nisn }}</p>
    </div>
    <div>
        <a href="{{ url_for('students.edit', student_id=student.id) }}" class="btn btn-warning me-2">
            <i class="fas fa-edit"></i> Edit
        </a>
        <a href="{{ url_for('students.index') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i> Kembali
        </a>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="main-content">
    <div class="row mb-4">
        <!-- Profile Card -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-body text-center">
                    <div class="profile-pic mb-3">
                        {% if student.photo %}
                            <img src="{{ url_for('static', filename=student.photo) }}" alt="Foto Santri" class="img-fluid rounded-circle" style="width:120px; height:120px; object-fit:cover;">
                        {% else %}
                            {% if student.jenis_kelamin == 'Perempuan' %}
                                <i class="fas fa-user-circle" style="font-size: 80px; color: #FF1493;"></i>
                            {% else %}
                                <i class="fas fa-user-circle" style="font-size: 80px; color: #4169E1;"></i>
                            {% endif %}
                        {% endif %}
                    </div>
                    <h4>{{ student.name }}</h4>
                    <p class="text-muted mb-3">{{ student.kelas }}</p>
                    
                    <div class="d-grid gap-2">
                        {% if student.status == 'aktif' %}
                            <span class="badge bg-success" style="padding: 8px;">
                                <i class="fas fa-check-circle"></i> Status Aktif
                            </span>
                        {% else %}
                            <span class="badge bg-danger" style="padding: 8px;">
                                <i class="fas fa-times-circle"></i> Status Non-Aktif
                            </span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Info Card -->
            <div class="card mt-3">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="fas fa-info-circle"></i> Informasi Pribadi</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label text-muted small">NISN</label>
                        <p class="mb-0"><code>{{ student.nisn }}</code></p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-muted small">Jenis Kelamin</label>
                        <p class="mb-0">
                            {% if student.jenis_kelamin == 'Perempuan' %}
                                <i class="fas fa-venus" style="color: #FF1493"></i> Perempuan
                            {% else %}
                                <i class="fas fa-mars" style="color: #4169E1"></i> Laki-laki
                            {% endif %}
                        </p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-muted small">No. Telepon</label>
                        <p class="mb-0">
                            <a href="tel:{{ student.phone }}">{{ student.phone }}</a>
                        </p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-muted small">Alamat</label>
                        <p class="mb-0 small">{{ student.alamat }}</p>
                    </div>
                </div>
            </div>

            <!-- Parent Info Card -->
            <div class="card mt-3">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="fas fa-family"></i> Data Orang Tua</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label text-muted small">Nama Orang Tua</label>
                        <p class="mb-0"><strong>{{ student.parent_name }}</strong></p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-muted small">No. Telepon</label>
                        <p class="mb-0">
                            <a href="tel:{{ student.parent_phone }}">{{ student.parent_phone }}</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Payment Stats -->
        <div class="col-md-8">
            <!-- Statistics Cards -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="balance-card" style="background: linear-gradient(135deg, #2E7D32 0%, #43A047 100%);">
                        <div class="balance-label">Total Pembayaran</div>
                        <div class="balance-value">{{ stats.total_payment|rupiah }}</div>
                        <div class="balance-count">{{ stats.payment_count }} transaksi</div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="balance-card" style="background: linear-gradient(135deg, #FF9800 0%, #FFB74D 100%);">
                        <div class="balance-label">Pembayaran Bulan Ini</div>
                        <div class="balance-value">{{ stats.month_payment|rupiah }}</div>
                        {% if stats.last_payment %}
                            <div class="balance-count">Terakhir: {{ stats.last_payment.date|format_date }}</div>
                        {% else %}
                            <div class="balance-count">Belum ada pembayaran</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Add Payment Form -->
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="fas fa-plus-circle"></i> Tambah Pembayaran</h6>
                </div>
                <div class="card-body">
                    <form action="{{ url_for('students.add_payment', student_id=student.id) }}" method="POST">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Jumlah (Rp)</label>
                                <input type="number" name="amount" class="form-control" placeholder="0" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Tanggal Pembayaran</label>
                                <input type="date" name="date" class="form-control" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Keterangan</label>
                            <input type="text" name="description" class="form-control" placeholder="Pembayaran Santri">
                        </div>
                        <button type="submit" class="btn btn-success w-100">
                            <i class="fas fa-save"></i> Simpan Pembayaran
                        </button>
                    </form>
                </div>
            </div>

            <!-- Payment History -->
            <div class="card">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="fas fa-history"></i> Riwayat Pembayaran</h6>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>No.</th>
                                <th>Tanggal</th>
                                <th>Keterangan</th>
                                <th>Jumlah</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if payments %}
                                {% for payment in payments %}
                                <tr>
                                    <td>{{ loop.index }}</td>
                                    <td>{{ payment.date|format_date }}</td>
                                    <td>{{ payment.description }}</td>
                                    <td>
                                        <strong class="text-success">{{ payment.amount|rupiah }}</strong>
                                    </td>
                                    <td>
                                        <span class="badge bg-success">
                                            <i class="fas fa-check-circle"></i> Diterima
                                        </span>
                                    </td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="5" class="text-center py-4 text-muted">
                                        <i class="fas fa-inbox"></i> Belum ada pembayaran
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.balance-card {
    padding: 30px 20px;
    border-radius: 10px;
    color: white;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
    margin-bottom: 20px;
}

.balance-label {
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 1px;
    opacity: 0.9;
    margin-bottom: 8px;
}

.balance-value {
    font-size: 28px;
    font-weight: bold;
    margin-bottom: 8px;
}

.balance-count {
    font-size: 12px;
    opacity: 0.8;
}

.profile-pic i {
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
}
</style>
{% endblock %}
